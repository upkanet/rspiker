<html>

<head>
    <title>Axorus - Spiker</title>
</head>
<style>
    body {
        background-color: black;
        font-family: Arial, Helvetica, sans-serif;
        color: white;
        margin: 0;
    }

    a {
        color: white;
    }
</style>
<script src="js/jquery3.5.1.min.js"></script>
<script src="js/plotly-latest.min.js"></script>
<script>
    var layoutBlack = { paper_bgcolor: 'black', plot_bgcolor: 'black', font: { color: 'white' }, xaxis: {'title': '', ticksuffix:'', spikemode: 'toaxis'}, yaxis: {spikemode: 'toaxis'}, hovermode: 'closest' };

    function plotEdata(electrode,mod){
        $.getJSON(`/electrode/${mod}/${electrode}`, function (el) {
            console.log(el);
            var data = el;
            var sample_rate = 20000;
            var plotName = "gElectrode";
            var d = {x: data.map((x,index) => index / sample_rate), y: data.map(x => x), type: 'line' };
            /*layoutBlack.xaxis.title = title;
            layoutBlack.xaxis.ticksuffix = ticksuffix;*/
            Plotly.newPlot(plotName, [d], layoutBlack);
        });
    }
    function plotERaster(electrode,timewidth){
        $.getJSON(`/electrode/s/${electrode}`, function (data) {
            /*const reducer = (accumulator, currentValue) => accumulator + currentValue;
            console.log(data.reduce(reducer) + " spikes");*/

            var sample_rate = 20000;
            var w = 70;
            var h = 55;
            var tw = timewidth;
            var th = Math.round((data.length / sample_rate) / tw);
            var sh = h / th * 0.8;

            var canvas = document.getElementById("raster_"+electrode);
            var ctx = canvas.getContext('2d');
            ctx.fillStyle="green";

            data.forEach((v,k) => {
                if(v > 0){
                    var t = k / sample_rate;
                    var x = t%tw / tw;
                    var y = Math.round(t/tw) / th;
                    ctx.fillRect(x * w,y * h,1,sh);
                }
            });

        });
    }

    function raster(timewidth = 2){
        //var n = 175;
        for(var n = 0; n < 256; n++){
            $('#raster').append(`<canvas id="raster_${n}" width="70" height="55"></canvas>`);
            plotERaster(n,timewidth);
        }
    }

</script>

<body>
    <div id="gElectrode" style="width:100%;height:100%;display: none;"></div>
    <div id="raster" style="width:1120px;"></div>
</body>

</html>